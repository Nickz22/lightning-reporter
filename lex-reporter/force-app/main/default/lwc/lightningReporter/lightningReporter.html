<!-- 
    TODO (Bugs)
    - The headers aren't aligning properly
 -->

<!-- 
    TODO (Features)
    - Mass update button
       * we're getting updated child records at this point
       * row inputs are not matching selected fields
    - Editable fields
    - Filter by current user in any user lookup
    - front end filter search
    - see all child records, see all parents of each row
    - better styling
 -->

<!-- headers aren't following the selected fields -->
<template>    
    <lightning-card>
        <div class="report-box">
            <lightning-layout multiple-rows>

                <!-- HEADER -->
                <lightning-layout-item size="3" 
                                       data-id="child-type-options">
                    <lightning-combobox
                            name="Select Child Type"
                            label="Select Child Type"
                            value={selectedType}
                            options={options}
                            onchange={handleChildTypeChange}>
                    </lightning-combobox>
                </lightning-layout-item>
                <lightning-layout-item size="6"></lightning-layout-item>
                <lightning-layout-item size="3" 
                                       padding="small-around">
                    <lightning-button
                        label="Get Records"
                        variant="neutral"
                        onclick={getChildRecords}>
                    </lightning-button>
                    <lightning-button
                        label="Save Changes"
                        variant="brand"
                        onclick={updateRecords}>
                    </lightning-button>
                </lightning-layout-item>
                <!-- END HEADER -->

                <!-- TABLE -->
                <lightning-layout-item size="9" 
                                       data-id="record-table"
                                       padding="around-medium"
                                       class="table-container">
                    <lightning-layout multiple-rows>
                        <lightning-layout-item size="12" 
                                                padding-around="large"
                                                class="table-header-container">
                            <template if:true={selectedFields}>
                                <c-table-header columns={selectedFields}></c-table-header>
                            </template>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" 
                                                class="table-data-container">
                            <template if:true={childRecords}>
                                <template for:each={childRecords} for:item="record">
                                    <c-table-row key={record.Id}
                                                data-id={record.Id}
                                                 s-object={record}>
                                    </c-table-row>
                                </template>
                            </template>
                        </lightning-layout-item>
                    </lightning-layout>
                </lightning-layout-item>
                <!-- END TABLE -->
                <!-- START FIELDS -->
                <lightning-layout-item size="3" 
                                       data-id="field-list"
                                       class="field-list">
                <template for:each={selectableFields} for:item="field">
                    <template if:true={field.defaultSelected}>
                        <p key={field.name} 
                            data-id={field.name}
                            class="field-name field-selected"
                            onclick={handleFieldClicked}>{field.name} ({field.type})
                        </p>
                    </template>
                    <template if:false={field.defaultSelected}>
                        <p key={field.name} 
                            data-id={field.name}
                            class="field-name"
                            onclick={handleFieldClicked}>{field.name} ({field.type})
                        </p>
                    </template>
                </template> 
                </lightning-layout-item>
                <!-- END FIELDS -->
            </lightning-layout>
        </div>
    </lightning-card>
</template>
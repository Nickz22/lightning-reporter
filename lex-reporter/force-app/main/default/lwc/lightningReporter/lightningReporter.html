<template>
    <lightning-card>
        <div class="report-box"> 
            <!-- if {hasPermission} is false, show text explainer -->
            <template if:false={hasPermission}>
                <div class="no-permission">
                    <h1>Permission Required</h1>
                    <p>You need the Lightning Reporter permission set to view this page.</p>
                </div>
            </template>
            <lightning-layout multiple-rows>
                <!-- TABLE ACTIONS -->
                <lightning-layout-item size="3" 
                                       data-id="child-type-options">
                    <c-picklist default-option={selectedType}
                                icon-name={iconName}
                                options={options}
                                onoptionselected={handleChildTypeSelected}></c-picklist>
                </lightning-layout-item>
                <lightning-layout-item size="5" 
                                      padding="horizontal-small"
                                      class="pinned-views">
                    <c-pill-collection pills={pinnedViews}
                                        onpillselected={setView}
                                        onpillremoved={removePin}></c-pill-collection>
                </lightning-layout-item>
                <lightning-layout-item size="1">
                    <template if:true={alert}>
                        <lightning-icon icon-name="utility:alert" 
                                    onclick={showAlerts}
                                    size="small"
                                    class="alerts red"></lightning-icon>
                    </template>
                    <template if:false={alert}>
                        <lightning-icon icon-name="utility:alert"
                                    size="small"
                                    class="alerts"></lightning-icon>
                    </template>
                </lightning-layout-item>
                <lightning-layout-item size="3"
                                        class="button-group">
                    <lightning-button
                        label="Run"
                        variant="neutral"
                        onclick={imperativeRefresh}>
                    </lightning-button>
                    <lightning-button
                        label="Save"
                        variant="brand"
                        onclick={saveRecords}>
                    </lightning-button>
                    <lightning-button
                        label=""
                        icon-name="utility:pin"
                        variant="neutral"
                        onclick={pinView}>
                    </lightning-button>
                </lightning-layout-item>
                <!-- END TABLE ACTIONS -->
                <!-- START TABLE -->
                <lightning-layout-item size="9" 
                                       data-id="record-table"
                                       padding="around-medium"
                                       class="table-container">
                    <template if:false={displayAlerts}>
                        <template if:true={isLoading}>
                            <lightning-spinner alternative-text="Loading"
                                                onclick={checkForSpinnerHardEscape}></lightning-spinner>
                        </template>
                        <template if:false={isLoading}>
                            <template if:true={selectedFields}>
                                <c-table selected-fields={selectedFields}
                                        child-records={childRecords}
                                        top-most-id={recordId}
                                        saved={saved}
                                        onedit={stopPoller}></c-table>
                            </template>
                        </template>
                    </template>
                    <template if:true={displayAlerts}>
                        <c-block-rows rows={alerts}
                                    onblockrowclick={focusOnAlertView}></c-block-rows>
                    </template>
                </lightning-layout-item>
                <!-- END TABLE -->
                <!-- START FIELDS -->
                <template if:true={selectableFields}>
                    <lightning-layout-item size="3" 
                                        data-id="field-list"
                                        class="field-list">
                        <c-block-rows rows={selectableFields}
                                        onblockrowclick={handleFieldClicked}></c-block-rows>
                    </lightning-layout-item>   
                </template>
                <!-- END FIELDS -->
            </lightning-layout>
        </div>
    </lightning-card>
</template>